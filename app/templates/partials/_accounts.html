<!-- 口座登録（オーバーレイ） -->

<div id="account-form-template" class="overlay-form-template">
  <div class="card">
    <h2>登録口座 <span class="pill">銀行・現金など</span></h2>

    <form method="post" action="/accounts" class="form">
      <label>
        口座名
        <input name="name" placeholder="生活口座 / 楽天銀行" required />
      </label>

      <label>
        残高（円）
        <input name="balance_yen" type="number" value="0" required />
      </label>

      <label>
        種別
        <select name="kind" required>
          <option value="bank">銀行</option>
          <option value="cash">現金</option>
          <option value="barcode">バーコード決済</option>
          <option value="emoney">電子マネー</option>
          <option value="nisa">NISA</option>
        </select>
      </label>

      <label>
        有効開始日
        <input name="effective_start_date" type="date" required />
      </label>

      <label>
        有効終了日（空欄で無期限）
        <input name="effective_end_date" type="date" />
      </label>

      <div class="actions col-span-all">
        <button class="btn" type="submit">口座を追加する</button>
      </div>
    </form>
  </div>
</div>

<!-- 口座一覧 -->

<div class="card">
  <div class="card-head">
    <h2>口座一覧</h2>
    <button class="btn btn-ghost btn-plus" type="button" data-overlay-open="account-form-template">＋ 追加</button>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th class="sticky-col" style="width: 140px">操作</th>
          <th style="width: 70px">ID</th>
          <th>口座名</th>
          <th style="width: 160px">残高（円）</th>
          <th style="width: 120px">種別</th>
          <th style="width: 150px">有効開始日</th>
          <th style="width: 170px">有効終了日</th>
        </tr>
      </thead>
      <tbody>
        {% for a in accounts %}
        {% set inactive = a.effective_end_date and a.effective_end_date <= today %}
        <tr data-edit-row class="{% if inactive %}row-inactive{% endif %}">
          <td class="edit-actions sticky-col">
            <button class="btn btn-ghost edit-btn" type="button" data-edit="start">編集</button>
            <form id="acc-{{ a.id }}" method="post" action="/accounts/{{ a.id }}/update" style="margin:0; display:inline;">
              <button class="btn save-btn" type="submit">保存</button>
            </form>
            <button class="btn btn-ghost cancel-btn" type="button" data-edit="cancel">キャンセル</button>
            <form method="post" action="/accounts/{{ a.id }}/delete" style="margin:0; display:inline;">
              <button class="btn btn-danger" type="submit">削除</button>
            </form>
          </td>
          <td>{{ a.id }}</td>
          <td>
            <input class="edit-input" name="name" value="{{ a.name }}" form="acc-{{ a.id }}" required />
          </td>
          <td class="money">
            <input class="edit-input" name="balance_yen" type="number" value="{{ a.balance_yen }}" form="acc-{{ a.id }}" required />
          </td>
          <td>
            <select class="edit-input" name="kind" form="acc-{{ a.id }}" required>
              <option value="bank" {% if a.kind == "bank" %}selected{% endif %}>銀行</option>
              <option value="cash" {% if a.kind == "cash" %}selected{% endif %}>現金</option>
              <option value="barcode" {% if a.kind == "barcode" %}selected{% endif %}>バーコード決済</option>
              <option value="emoney" {% if a.kind == "emoney" %}selected{% endif %}>電子マネー</option>
              <option value="nisa" {% if a.kind == "nisa" %}selected{% endif %}>NISA</option>
            </select>
          </td>
          <td>
            <input class="edit-input" name="effective_start_date" type="date" value="{{ a.effective_start_date.isoformat() if a.effective_start_date else '' }}" form="acc-{{ a.id }}" required />
          </td>
          <td>
            <input class="edit-input" name="effective_end_date" type="date" value="{{ a.effective_end_date.isoformat() if a.effective_end_date else '' }}" form="acc-{{ a.id }}" />
          </td>
        </tr>
        {% endfor %}

        {% if not accounts %}
        <tr>
          <td colspan="7" class="empty">口座がありません。先に追加してください。</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
